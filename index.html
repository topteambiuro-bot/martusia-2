<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Misja: Serce</title>
    <style>
        :root {
            --primary: #ff2d55;
            --accent: #ffb3c1;
            --bg: #0a0204;
            --glass: rgba(255, 255, 255, 0.05);
            --glow: 0 0 20px rgba(255, 45, 85, 0.5);
        }

        .progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 8px; background: rgba(255, 255, 255, 0.1); z-index: 1000; }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary), #ff5e7e); box-shadow: 0 0 15px var(--primary); transition: width 0.6s ease; }
        #step-counter { position: fixed; top: 15px; right: 15px; font-size: 0.7rem; color: var(--accent); letter-spacing: 1px; z-index: 1000; opacity: 0.8; }

        body { margin: 0; padding: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; background: var(--bg); color: #fff; font-family: 'Segoe UI', Roboto, sans-serif; text-align: center; overflow: hidden; background: radial-gradient(circle at center, #1e0509 0%, #0a0204 100%); }
        .bg-pulse { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, rgba(255,45,85,0.05) 0%, transparent 70%); animation: pulseBg 8s infinite alternate; z-index: -1; }
        @keyframes pulseBg { from { transform: scale(1); opacity: 0.5; } to { transform: scale(1.5); opacity: 0.8; } }

        .screen { display: none; width: 85%; max-width: 400px; padding: 30px 20px; background: var(--glass); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); animation: slideUp 0.6s ease-out; z-index: 10; flex-direction: column; align-items: center; position: relative; }
        .active { display: flex; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        h1 { font-size: 1.2rem; text-transform: uppercase; letter-spacing: 4px; color: var(--accent); margin-bottom: 20px; text-shadow: var(--glow); }
        .btn-main { background: linear-gradient(45deg, var(--primary), #ff5e7e); border: none; color: white; padding: 16px 35px; border-radius: 50px; font-weight: bold; text-transform: uppercase; cursor: pointer; transition: 0.3s; margin-top: 20px; box-shadow: 0 5px 15px rgba(255, 45, 85, 0.4); }
        .btn-main:disabled { background: #444; box-shadow: none; cursor: not-allowed; opacity: 0.6; }
        .btn-ghost { background: transparent; border: 1px solid var(--accent); color: var(--accent); padding: 10px 20px; border-radius: 50px; font-size: 0.7rem; cursor: pointer; margin-top: 15px; }

        input { background: rgba(0,0,0,0.3); border: 1px solid var(--primary); color: white; padding: 15px; border-radius: 15px; text-align: center; font-size: 1.2rem; width: 80%; margin-top: 15px; outline: none; }

        /* Timer Styles */
        #timer-display { font-size: 1.5rem; font-weight: bold; color: var(--primary); margin: 20px 0; font-family: monospace; }
        .timer-unit { font-size: 0.6rem; color: var(--accent); text-transform: uppercase; display: block; }

        #arrow { font-size: 100px; color: var(--primary); filter: drop-shadow(0 0 25px var(--primary)); margin: 20px 0; transition: transform 0.2s ease-out; }
        #distance { font-size: 5rem; font-weight: 900; text-shadow: var(--glow); }
        
        #petal-area { position: relative; width: 280px; height: 280px; background: rgba(0,0,0,0.2); border-radius: 50%; margin-top: 15px; }
        .petal { position: absolute; cursor: pointer; font-size: 2rem; transition: 0.4s; }
        .memory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 20px; }
        .card { width: 80px; height: 80px; background: rgba(255,255,255,0.05); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; }
        .card.flipped { background: var(--primary); }
    </style>
</head>
<body>

    <div class="progress-container"><div id="progress-bar"></div></div>
    <div id="step-counter" style="display:none;">KROK 1 / 7</div>
    <div class="bg-pulse"></div>

    <div id="lock-screen" class="screen active">
        <h1>Misja Rozpocznie siƒô za:</h1>
        <div id="timer-display">--:--:--:--</div>
        <p style="font-size: 0.8rem; opacity: 0.7;">Dostƒôp zostanie odblokowany<br>14.02.2026 o 18:00</p>
        <button id="start-btn" class="btn-main" disabled onclick="next('step1')">Rozpocznij misjƒô</button>
        
        <div style="margin-top: 40px; opacity: 0.3; font-size: 0.6rem;" onclick="showTestMode()">Tryb testowy</div>
        <div id="test-input-area" style="display:none; margin-top:10px;">
            <input type="text" id="test-pass" placeholder="Has≈Ço..." style="padding: 8px; width: 60%; font-size: 0.8rem;">
            <button class="btn-ghost" onclick="checkTestPass()">Odblokuj</button>
        </div>
    </div>

    <div id="step1" class="screen">
        <h1>Pr√≥ba Amora</h1>
        <canvas id="amor-canvas" width="300" height="300" style="background:rgba(0,0,0,0.2); border-radius:20px;"></canvas>
    </div>

    <div id="step-flappy" class="screen">
        <h1>Lot Serca</h1>
        <p id="flappy-desc" style="font-size: 0.8rem; opacity: 0.7;">ZdobƒÖd≈∫ 35 punkt√≥w!</p>
        <canvas id="flappy-canvas" width="300" height="350" style="background:rgba(0,0,0,0.2); border-radius:20px;"></canvas>
    </div>

    <div id="step2" class="screen"><h1>Ogr√≥d Wspomnie≈Ñ</h1><div id="petal-area"></div></div>
    <div id="step3" class="screen"><h1>Szyfr Serca</h1><input type="text" id="answerInput" placeholder="Imiƒô..."><button class="btn-main" onclick="checkAnswer()">Dalej</button></div>
    <div id="step4" class="screen"><h1>Synchronizacja</h1><div class="memory-grid" id="grid"></div></div>
    <div id="step5" class="screen"><h1>Namierzanie...</h1><div id="arrow">‚ûî</div><div id="distance">--</div></div>
    <div id="final" class="screen"><h1>Jeste≈õ u celu! ‚ù§Ô∏è</h1><div style="font-size: 70px;">üéÅ</div></div>

    <script>
        const targetDate = new Date("2026-02-14T18:00:00").getTime();
        const targetPos = { lat: 50.398567, lon: 18.913362 };
        const CORRECT_ANSWER = "pimpek"; 
        const loveNotes = ["Jeste≈õ cudowna", "M√≥j skarb", "Kocham Ciƒô", "Za Tw√≥j u≈õmiech", "Za nasze chwile", "Moja jedyna", "Dziƒôkujƒô, ≈ºe jeste≈õ", "Zawsze Ty", "Na zawsze", "Moje szczƒô≈õcie", "Uwielbiam Ciƒô", "M√≥j ≈õwiat"];
        const screens = ['lock-screen', 'step1', 'step-flappy', 'step2', 'step3', 'step4', 'step5', 'final'];

        // --- TIMER LOGIC ---
        const timerInterval = setInterval(function() {
            const now = new Date().getTime();
            const diff = targetDate - now;

            if (diff <= 0) {
                clearInterval(timerInterval);
                document.getElementById("timer-display").innerHTML = "00:00:00:00";
                document.getElementById("start-btn").disabled = false;
            } else {
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                document.getElementById("timer-display").innerHTML = 
                    `${String(days).padStart(2, '0')}d ${String(hours).padStart(2, '0')}h ${String(minutes).padStart(2, '0')}m ${String(seconds).padStart(2, '0')}s`;
            }
        }, 1000);

        function showTestMode() { document.getElementById('test-input-area').style.display = 'block'; }
        function checkTestPass() {
            if(document.getElementById('test-pass').value === "Feniks") {
                document.getElementById("start-btn").disabled = false;
                alert("Tryb testowy odblokowany!");
            } else { alert("B≈Çƒôdne has≈Ço"); }
        }

        // --- NAVIGATION ---
        function updateProgress(id) {
            const index = screens.indexOf(id);
            if(index === 0) return;
            document.getElementById('step-counter').style.display = 'block';
            const progress = (index / (screens.length - 1)) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
            document.getElementById('step-counter').innerText = `KROK ${index} / ${screens.length - 1}`;
        }

        function next(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            updateProgress(id);
            if(id === 'step1') drawAmor();
            if(id === 'step-flappy') initFlappy();
            if(id === 'step2') initPetals();
            if(id === 'step4') initMemory();
            if(id === 'step5') startGps();
        }

        // --- AMOR ---
        const canvas = document.getElementById('amor-canvas');
        const ctx = canvas.getContext('2d');
        let hits = 0, aArrow = null, targetH = { x: 50, y: 50, dir: 2.5 };
        function drawAmor() {
            if(!document.getElementById('step1').classList.contains('active')) return;
            ctx.clearRect(0,0,300,300);
            targetH.x += targetH.dir;
            if(targetH.x > 260 || targetH.x < 10) targetH.dir *= -1;
            ctx.font = "30px Arial"; ctx.fillText("üíñ", targetH.x, 60);
            ctx.fillText("üèπ", 135, 280);
            if(aArrow) {
                aArrow.y -= 8; ctx.fillText("üíò", aArrow.x, aArrow.y);
                if(aArrow.y < 70 && aArrow.y > 30 && aArrow.x > targetH.x - 15 && aArrow.x < targetH.x + 35) { 
                    hits++; aArrow = null; 
                    if(hits >= 7) { setTimeout(() => next('step-flappy'), 500); return; }
                }
                else if(aArrow.y < 0) { hits = 0; aArrow = null; }
            }
            ctx.fillStyle = "white"; ctx.font = "14px Arial"; ctx.fillText("Trafienia: " + hits + "/7", 10, 20);
            requestAnimationFrame(drawAmor);
        }
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); if(!aArrow) aArrow = {x: 135, y: 250}; });

        // --- FLAPPY HEART ---
        const fCanvas = document.getElementById('flappy-canvas');
        const fCtx = fCanvas.getContext('2d');
        let heart = { y: 150, v: 0 }, pipes = [], fScore = 0, fActive = false, fLimit = 35;
        function initFlappy() { fActive = true; heart.y = 150; heart.v = 0; pipes = []; fScore = 0; spawnPipe(); drawFlappy(); }
        function spawnPipe() { pipes.push({ x: 300, top: Math.random()*150+50, passed: false }); }
        function drawFlappy() {
            if(!fActive || !document.getElementById('step-flappy').classList.contains('active')) return;
            fCtx.clearRect(0,0,300,350);
            heart.v += 0.22; heart.y += heart.v;
            fCtx.font = "25px Arial"; fCtx.fillText("‚ù§Ô∏è", 50, heart.y);
            for(let i=pipes.length-1; i>=0; i--) {
                pipes[i].x -= 2.2;
                fCtx.fillStyle = "rgba(255,45,85,0.5)";
                fCtx.fillRect(pipes[i].x, 0, 40, pipes[i].top);
                fCtx.fillRect(pipes[i].x, pipes[i].top + 100, 40, 350);
                if(50 > pipes[i].x && 50 < pipes[i].x+40 && (heart.y-20 < pipes[i].top || heart.y+5 > pipes[i].top+100)) { fActive=false; setTimeout(initFlappy,600); }
                if(!pipes[i].passed && pipes[i].x < 50) { fScore++; pipes[i].passed = true; if(fScore >= fLimit) { fActive = false; next('step2'); return; } }
                if(pipes[i].x < -40) pipes.splice(i,1);
            }
            if(pipes.length > 0 && pipes[pipes.length-1].x < 140) spawnPipe();
            if(heart.y > 350 || heart.y < 0) { fActive=false; setTimeout(initFlappy,600); }
            fCtx.fillStyle = "white"; fCtx.font = "bold 16px Arial"; fCtx.fillText("PKT: "+fScore+" / " + fLimit, 15, 25);
            requestAnimationFrame(drawFlappy);
        }
        fCanvas.addEventListener('touchstart', (e) => { e.preventDefault(); heart.v = -4.5; });

        // --- P≈ÅATKI ---
        function initPetals() {
            const area = document.getElementById('petal-area'); area.innerHTML = '';
            let left = 12;
            for(let i=0; i<12; i++) {
                const p = document.createElement('div'); p.className = 'petal'; p.innerText = 'üå∏';
                p.style.left = Math.random()*230+'px'; p.style.top = Math.random()*230+'px';
                p.onclick = () => { p.remove(); left--; if(left === 0) next('step3'); };
                area.appendChild(p);
            }
        }

        // --- SZYFR ---
        function checkAnswer() { if(document.getElementById('answerInput').value.toLowerCase().trim() === CORRECT_ANSWER) next('step4'); else alert("Nie!"); }

        // --- MEMORY ---
        function initMemory() {
            const grid = document.getElementById('grid'); grid.innerHTML = '';
            const items = ['‚ù§Ô∏è','üî•','üíç','‚ù§Ô∏è','üî•','üíç'].sort(()=>Math.random()-0.5);
            items.forEach(icon => {
                const c = document.createElement('div'); c.className = 'card';
                c.onclick = () => {
                    if(c.classList.contains('flipped')) return;
                    c.innerText = icon; c.classList.add('flipped');
                    const active = document.querySelectorAll('#step4 .flipped:not(.matched)');
                    if(active.length === 2) {
                        if(active[0].innerText === active[1].innerText) { active.forEach(a => a.classList.add('matched')); if(document.querySelectorAll('.matched').length === 6) next('step5'); }
                        else { setTimeout(() => active.forEach(a => {a.classList.remove('flipped'); a.innerText=''}), 600); }
                    }
                };
                grid.appendChild(c);
            });
        }

        // --- GPS ---
        let currentBearingToTarget = 0;
        function startGps() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(r => { if(r=='granted') window.addEventListener('deviceorientation', hOrient, true); });
            } else { window.addEventListener('deviceorientation', hOrient, true); }
            navigator.geolocation.watchPosition(pos => {
                const d = calcDist(pos.coords.latitude, pos.coords.longitude, targetPos.lat, targetPos.lon);
                currentBearingToTarget = calcBear(pos.coords.latitude, pos.coords.longitude, targetPos.lat, targetPos.lon);
                document.getElementById('distance').innerText = Math.round(d);
                if(d < 15) next('final');
            }, null, {enableHighAccuracy: true});
        }
        function hOrient(e) {
            let h = e.webkitCompassHeading || (360 - e.alpha);
            document.getElementById('arrow').style.transform = `rotate(${currentBearingToTarget - h}deg)`;
        }
        function calcDist(l1, o1, l2, o2) {
            const R = 6371000;
            const dL = (l2-l1)*Math.PI/180, dO = (o2-o1)*Math.PI/180;
            const a = Math.sin(dL/2)**2 + Math.cos(l1*Math.PI/180)*Math.cos(l2*Math.PI/180)*Math.sin(dO/2)**2;
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }
        function calcBear(l1, o1, l2, o2) {
            const lat1 = l1 * Math.PI / 180, lat2 = l2 * Math.PI / 180, dLon = (o2 - o1) * Math.PI / 180;
            const y = Math.sin(dLon) * Math.cos(lat2);
            const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);
            return (Math.atan2(y, x) * 180 / Math.PI + 360) % 360;
        }
    </script>
</body>
</html>
